# Phase 8: Python Export Template

## Goal
Create a Python/FastAPI code generation template that can generate deployable agent code from a build configuration for Docker/local deployment.

## Template Structure

### File Location
`templates/python/agent_template.py`

### Template Features
The template will be a Python file that:
- Imports necessary dependencies (Anthropic SDK, FastAPI, Pydantic)
- Defines Pydantic models for request/response validation
- Implements the agent execution function
- Includes FastAPI application with API endpoint
- Uses template variables for dynamic content injection

### Template Variables
The template will use placeholders that get replaced during code generation:
- `{{BUILD_ID}}` - Unique build identifier
- `{{TIMESTAMP}}` - Generation timestamp
- `{{AGENT_CONFIG}}` - Complete agent configuration (Python dict format)

### Code Structure

1. **Header Comments**
   - Generated by AgentEX
   - Build ID
   - Generation timestamp

2. **Imports**
   - Anthropic SDK
   - FastAPI and related dependencies
   - Pydantic for data validation
   - OS for environment variables

3. **FastAPI Application**
   - Initialize FastAPI app
   - Initialize Anthropic client

4. **Pydantic Models**
   - Message model (role, content)
   - AgentRequest model (messages list)

5. **Agent Configuration**
   - Template variable for dynamic config injection
   - Includes model settings and tools array

6. **Agent Execution Function**
   - `run_agent(request: AgentRequest)` - Core agent logic
   - Handles API calls to Anthropic
   - Error handling with HTTP exceptions

7. **FastAPI Endpoint**
   - POST `/agent` endpoint
   - Accepts AgentRequest
   - Returns agent response

8. **Main Block**
   - Uvicorn server configuration
   - Runs on 0.0.0.0:8000

## Implementation Steps

1. **Create agent_template.py file**
   - Write header comments with template variables
   - Add imports (Anthropic, FastAPI, Pydantic, uvicorn)
   - Initialize FastAPI app and Anthropic client
   - Define Pydantic models
   - Create agent configuration placeholder
   - Implement run_agent function
   - Add FastAPI POST endpoint
   - Include error handling
   - Add main block with uvicorn

2. **Validate template**
   - Ensure all template variables are present
   - Verify Python syntax is correct
   - Check that template can be processed by code generator

## Template Details

### Key Features
- Uses Anthropic SDK for Claude models
- FastAPI for REST API
- Pydantic for request/response validation
- Supports tool calls
- Includes proper error handling
- Ready for Docker deployment
- Type-safe with Pydantic models

### Configuration Injection
The `{{AGENT_CONFIG}}` variable will be replaced with:
- Model name from selected brain component
- Temperature, max_tokens from brain config
- Tools array from selected tool components
- Any additional settings from build configuration
- Formatted as Python dictionary

## Success Criteria
- [ ] agent_template.py file created in templates/python/
- [ ] All template variables defined (BUILD_ID, TIMESTAMP, AGENT_CONFIG)
- [ ] Pydantic models defined
- [ ] Agent execution function implemented
- [ ] FastAPI endpoint included
- [ ] Error handling present
- [ ] Uvicorn server configuration included
- [ ] Template is valid Python
- [ ] Ready for code generation system

## Dependencies
- Phase 2 must be complete (schemas defined for reference)

## Notes
- Template uses Anthropic SDK (can be extended for other providers)
- Template variables use double curly braces for clarity
- Code generator will replace variables with actual values
- Template follows FastAPI best practices
- Ready for Docker containerization
- Can be extended later for additional features (streaming, webhooks, etc.)
