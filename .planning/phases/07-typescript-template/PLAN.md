# Phase 7: TypeScript Export Template

## Goal
Create a TypeScript/Next.js code generation template that can generate deployable agent code from a build configuration.

## Template Structure

### File Location
`templates/typescript/agent-template.ts`

### Template Features
The template will be a TypeScript file that:
- Imports necessary dependencies (Anthropic SDK)
- Defines TypeScript interfaces for messages and agent configuration
- Implements the agent execution function
- Includes Next.js API route handler
- Uses template variables for dynamic content injection

### Template Variables
The template will use placeholders that get replaced during code generation:
- `{{BUILD_ID}}` - Unique build identifier
- `{{TIMESTAMP}}` - Generation timestamp
- `{{AGENT_CONFIG}}` - Complete agent configuration JSON (stringified)

### Code Structure

1. **Header Comments**
   - Generated by AgentEX
   - Build ID
   - Generation timestamp

2. **Imports**
   - Anthropic SDK
   - TypeScript types

3. **Type Definitions**
   - Message interface (role, content)
   - AgentConfig interface (model, temperature, max_tokens, tools)

4. **Agent Configuration**
   - Template variable for dynamic config injection
   - Includes model settings and tools array

5. **Agent Execution Function**
   - `runAgent(messages: Message[])` - Core agent logic
   - Handles API calls to Anthropic
   - Error handling

6. **Next.js API Route Handler**
   - `POST` handler for API routes
   - Accepts messages from request body
   - Returns agent response

## Implementation Steps

1. **Create agent-template.ts file**
   - Write header comments with template variables
   - Add imports (Anthropic SDK)
   - Define TypeScript interfaces
   - Create agent configuration placeholder
   - Implement runAgent function
   - Add Next.js API route handler
   - Include error handling

2. **Validate template**
   - Ensure all template variables are present
   - Verify TypeScript syntax is correct
   - Check that template can be processed by code generator

## Template Details

### Key Features
- Uses Anthropic SDK for Claude models
- Supports streaming (configurable)
- Handles tool calls
- Includes proper error handling
- Ready for Next.js App Router deployment
- Type-safe with TypeScript interfaces

### Configuration Injection
The `{{AGENT_CONFIG}}` variable will be replaced with:
- Model name from selected brain component
- Temperature, max_tokens from brain config
- Tools array from selected tool components
- Any additional settings from build configuration

## Success Criteria
- [ ] agent-template.ts file created in templates/typescript/
- [ ] All template variables defined (BUILD_ID, TIMESTAMP, AGENT_CONFIG)
- [ ] TypeScript interfaces defined
- [ ] Agent execution function implemented
- [ ] Next.js API route handler included
- [ ] Error handling present
- [ ] Template is valid TypeScript
- [ ] Ready for code generation system

## Dependencies
- Phase 2 must be complete (schemas defined for reference)

## Notes
- Template uses Anthropic SDK (can be extended for other providers)
- Template variables use double curly braces for clarity
- Code generator will replace variables with actual values
- Template follows Next.js 14 App Router conventions
- Can be extended later for additional features (streaming, webhooks, etc.)
